(function () {
    function createMask(egismap, maskGeojson, maskColor) {
        
        var canvaslayer = new egis.carto.TileLayer({
            name: '天地图矢量',
            layers: 'maskLayer',
            '//': '图层名称',
            matrix: 21,
            '//': '切图级别小于等于切图级别',
            matrixSet: 'c',
            '//': '切图策略',
            matrixPrefix: '',
            '//': '切图策略加冒号：',
            format: 'tiles',
            '//': '图层格式',
            projection: 'EPSG:4490',
            '//': '投影参考',
            layerType: 1,
            '//': '图层类型',
            tileType: 102,
            '//': '瓦片类型',
            opacity: 1.0,
            '/': '透明度',
            visible: true,
            '//': '是否显示',
            crossOrigin: 'anonymous',
            style: 'default',
            extent: { minx: -180, miny: -90, maxx: 0, maxy: 0 },
            url: 'http://t0.tianditu.gov.cn/vec_c/wmts?tk=4f62e1d82bd46e2ff470b291c2260156',
        });
        egismap.addLayer(canvaslayer);
        const layer = canvaslayer.getLayer();
        const viewSize = egismap.getViewSize()
        addconver(maskGeojson);
        layer.on('postrender', function (event) {
            var ctx = event.context;
            ctx.restore();
        });
        return canvaslayer
        function addconver(coords) {
            layer.on('prerender', clip);
            function clip(evt) {
                var canvas = evt.context;
                canvas.save();
                createMask(canvas);
                createClip(coords, canvas);
                canvas.clearRect(0, 0, viewSize[0],viewSize[1]);
            }
            function createMask(canvas) {
                canvas.fillStyle = maskColor;
                canvas.fillRect(0, 0,viewSize[0],viewSize[1]);
            }
            function createClip(coords, canvas) {
                canvas.beginPath();
                for (var i = 0, cout = coords.length; i < cout; i++) {
                    //获取屏幕坐标
                    var screenCoord = egismap.getPixelFromCoordinate(coords[i]);
                    var x = screenCoord[0],
                        y = screenCoord[1];
                    if (i === 0) {
                        canvas.moveTo(x, y);
                    } else {
                        canvas.lineTo(x, y);
                    }
                }
                canvas.closePath();
                canvas.strokeStyle = '#dedede';
                canvas.lineWidth = 2;
                canvas.stroke();
                canvas.clip();
            }
        }
    }
    const ntGeo = [[120.80813648028523,31.991496003311646],[120.800992,31.997925000000002],[120.79581400000001,31.999603999999998],[120.76099000000002,32.000175],[120.73643199999998,32.000296],[120.71256499999998,31.999889999999997],[120.680064,31.998935],[120.66717300000002,31.999056000000003],[120.642633,31.999022999999998],[120.611603,31.997771000000004],[120.602755,31.998287],[120.584562,32.000988],[120.568019,32.00595],[120.54759200000001,32.013426],[120.552734,32.025609],[120.555997,32.029527],[120.55753899999999,32.033314],[120.551936,32.036288],[120.544099,32.042214],[120.54596100000002,32.042839],[120.54743300000001,32.047898],[120.54784,32.051914],[120.54597900000002,32.054624],[120.531953,32.059243],[120.517927,32.063259],[120.517661,32.063994],[120.520782,32.068941],[120.519523,32.07266],[120.513441,32.085571],[120.51225300000002,32.093139],[120.496969,32.098535],[120.49485900000002,32.09996],[120.488901,32.100136],[120.48879500000001,32.101276],[120.485674,32.101079],[120.48253500000001,32.103645],[120.47150700000002,32.107966],[120.46808400000002,32.109852000000004],[120.46673699999998,32.112012],[120.46650599999998,32.109906],[120.463155,32.1112],[120.46225100000001,32.110137],[120.457055,32.112757],[120.456736,32.113722],[120.44787100000002,32.117209],[120.44703700000001,32.115521],[120.44498000000002,32.116288],[120.44512199999998,32.118558],[120.43599,32.123338],[120.434501,32.126233],[120.43301200000002,32.123908],[120.427586,32.125191],[120.427621,32.122878],[120.41902199999998,32.123996],[120.41868500000001,32.12297600000001],[120.411574,32.124665],[120.41077600000001,32.123239],[120.40778000000002,32.124599],[120.40723,32.123294],[120.399978,32.123503],[120.39535000000001,32.125147],[120.395793,32.126024],[120.391449,32.127417],[120.39160899999999,32.128217],[120.386218,32.129006],[120.376271,32.128875],[120.376076,32.127735],[120.36276,32.130453],[120.356128,32.130782],[120.355437,32.134827],[120.356235,32.137316],[120.358061,32.137623],[120.35747600000002,32.140341],[120.355543,32.140067],[120.35509999999998,32.142358],[120.35282999999998,32.141602],[120.354036,32.148891],[120.35132299999998,32.149768],[120.35100399999999,32.152705],[120.34768800000002,32.153747],[120.34536500000002,32.15847],[120.349319,32.160027],[120.34763500000001,32.161945],[120.34939,32.164071],[120.34797199999998,32.166876],[120.34517000000001,32.16852],[120.346358,32.173056],[120.348663,32.176979],[120.350738,32.182414],[120.35327300000002,32.181702],[120.35456799999999,32.185723],[120.352936,32.18569],[120.354461,32.190368],[120.35783000000002,32.189875],[120.359568,32.195211],[120.36134100000001,32.196668],[120.36075600000001,32.201181],[120.363469,32.20301],[120.36299000000001,32.204599],[120.366483,32.20794],[120.36721,32.212387],[120.370881,32.212693],[120.370845,32.221499],[120.373328,32.221729],[120.372672,32.225508],[120.37103999999998,32.227413],[120.369356,32.226931],[120.37036600000002,32.22933],[120.362884,32.238287],[120.364621,32.238616],[120.36020600000002,32.24074],[120.35891200000002,32.239842],[120.35478099999999,32.241802],[120.35118100000001,32.245032],[120.348592,32.245809],[120.34951400000001,32.247857],[120.34705000000001,32.250255],[120.34646499999998,32.253025],[120.349904,32.255543],[120.34930200000001,32.26013],[120.34681899999998,32.267256],[120.35127,32.269599],[120.350507,32.272981],[120.352422,32.275017],[120.35208499999999,32.276943],[120.349603,32.276812],[120.350951,32.282262],[120.351997,32.291105],[120.35086200000002,32.296369],[120.34898200000002,32.300199],[120.35100399999999,32.301622],[120.351146,32.30381],[120.355472,32.30462],[120.35639399999998,32.302639],[120.36075600000001,32.303482],[120.359923,32.305692],[120.35818500000002,32.305758],[120.36306100000002,32.308417],[120.36641200000001,32.312585],[120.36465699999998,32.315649],[120.362937,32.31543],[120.361093,32.318231],[120.356873,32.320594],[120.356217,32.323],[120.35325599999999,32.32428],[120.352635,32.328142],[120.353593,32.329695],[120.35121699999999,32.332102],[120.35322000000001,32.33418000000001],[120.35121699999999,32.336904],[120.35006399999999,32.335176],[120.347369,32.334355],[120.347387,32.338063],[120.345046,32.34106],[120.34614500000002,32.343554],[120.349621,32.343729],[120.34555999999999,32.345883],[120.348096,32.346737],[120.34914200000001,32.348651],[120.34740400000001,32.356164],[120.350206,32.355551],[120.353522,32.356864],[120.35549,32.359477],[120.354266,32.360844],[120.35616400000002,32.361752],[120.357139,32.362812],[120.357529,32.367853],[120.35494000000001,32.367208],[120.35197900000001,32.368236],[120.350543,32.377967],[120.344301,32.376207],[120.342581,32.374326],[120.33673000000002,32.373167],[120.331481,32.371101],[120.32804199999998,32.368378],[120.321587,32.368269],[120.31628600000002,32.366235],[120.314282,32.364857],[120.313342,32.361916],[120.30898,32.361806],[120.30704800000001,32.365557],[120.304636,32.367689],[120.30142700000002,32.372467],[120.294955,32.369778],[120.291834,32.37144],[120.288926,32.370696],[120.28686900000001,32.375332],[120.284741,32.375059],[120.283128,32.380011],[120.28561000000002,32.38187],[120.28807500000002,32.385073],[120.288128,32.389173],[120.28353600000001,32.400432],[120.283199,32.405372],[120.282135,32.40864],[120.28444,32.407941],[120.28408500000002,32.411045],[120.281603,32.411624],[120.279901,32.42217],[120.280592,32.431261],[120.278766,32.436244],[120.27511300000002,32.438888],[120.275007,32.442996],[120.271975,32.45886900000001],[120.272737,32.462342],[120.27135400000002,32.465051],[120.271744,32.471572],[120.26981199999999,32.47357],[120.26904900000001,32.476344],[120.264492,32.48721],[120.261886,32.490628],[120.258765,32.49089],[120.25764800000002,32.492746],[120.258623,32.501023],[120.267631,32.502278],[120.266531,32.507595],[120.26431499999998,32.507366],[120.26417300000001,32.516372],[120.262985,32.516645],[120.26550300000001,32.532462],[120.269687,32.549115],[120.26677900000001,32.552651],[120.26530799999999,32.558041],[120.26360600000001,32.559089],[120.26224,32.562089],[120.265609,32.564621],[120.25970500000001,32.570534],[120.26029,32.574134],[120.26156600000002,32.575301],[120.25910200000001,32.580614],[120.25927899999999,32.582708],[120.257683,32.585141],[120.25887099999998,32.5909],[120.256602,32.593714],[120.255999,32.596037],[120.253711,32.598862],[120.252435,32.598611],[120.252789,32.593529],[120.24901300000002,32.595077],[120.24333899999999,32.593943],[120.243906,32.590824],[120.23922500000002,32.592405],[120.23442,32.588184],[120.22828499999999,32.587737],[120.22644,32.584585],[120.22319599999999,32.582348],[120.217522,32.584486],[120.217451,32.585926],[120.21470199999999,32.588795],[120.207131,32.591086],[120.20555300000001,32.592645],[120.20647500000001,32.594903],[120.20370900000002,32.595983],[120.20206,32.601469],[120.203531,32.601632],[120.205074,32.60478400000001],[120.208851,32.603454],[120.21225499999998,32.603399],[120.21277000000002,32.606409],[120.207752,32.608983],[120.20856700000002,32.614784],[120.206865,32.614817],[120.207113,32.617183],[120.209259,32.617074],[120.21117400000001,32.620596],[120.21300000000001,32.627465],[120.214862,32.629384],[120.21757500000001,32.628751],[120.21904599999999,32.635282],[120.220979,32.635304],[120.22199,32.642542],[120.220359,32.649333],[120.227824,32.649388],[120.228586,32.654009],[120.22601499999999,32.654402],[120.22730899999999,32.657704],[120.22363900000002,32.658576],[120.22413500000002,32.663055],[120.22335500000001,32.672242],[120.225713,32.673833],[120.22450799999999,32.676296],[120.23167100000002,32.677517],[120.23442,32.672264],[120.23394100000002,32.675413],[120.235714,32.675588],[120.23615699999999,32.672864],[120.239828,32.674367],[120.24163600000001,32.672188],[120.243977,32.671839],[120.243693,32.674247],[120.24624599999999,32.673169],[120.24518299999998,32.67124],[120.24690299999999,32.670924],[120.246743,32.674651],[120.248658,32.674215],[120.248853,32.676906],[120.25067900000002,32.677517],[120.25030700000002,32.68011],[120.256797,32.680241],[120.26599900000001,32.679903],[120.268588,32.679456],[120.278269,32.679936],[120.28055700000002,32.681646],[120.291479,32.687726],[120.307473,32.700517],[120.30986700000001,32.698022],[120.309902,32.700146],[120.31208300000002,32.701737],[120.311073,32.702728],[120.316942,32.705626],[120.31882099999999,32.704079],[120.31813000000001,32.702695],[120.31979600000001,32.700822],[120.31848400000001,32.699035],[120.32196,32.699046],[120.32623300000002,32.700658],[120.327439,32.698784],[120.330258,32.699057],[120.332084,32.701181],[120.33121499999999,32.705462],[120.333308,32.70468900000001],[120.338095,32.705691],[120.346216,32.705386000000004],[120.347936,32.703033],[120.351075,32.702597],[120.353947,32.705375],[120.35971000000002,32.707085],[120.360472,32.706214],[120.370827,32.70544],[120.37292,32.708284],[120.37524299999998,32.709318],[120.37753,32.712554],[120.38047300000001,32.712880000000006],[120.38800900000001,32.709395],[120.391449,32.709003],[120.39379,32.707804],[120.393346,32.705397],[120.39113,32.705375],[120.38886,32.691463],[120.39393200000002,32.689023],[120.39730100000001,32.689241],[120.397354,32.687693],[120.40004900000001,32.686963],[120.40895000000002,32.688936],[120.41054599999998,32.685329],[120.41263800000002,32.686048],[120.41712399999999,32.681363],[120.414482,32.680186],[120.415351,32.678628],[120.418933,32.678388],[120.426114,32.675294],[120.430813,32.675751000000005],[120.436611,32.648221],[120.44077799999998,32.643894],[120.43948399999998,32.643109],[120.44143400000002,32.640689],[120.44409400000002,32.641899],[120.44607999999998,32.641517],[120.448048,32.639359000000006],[120.44317200000002,32.637626000000004],[120.44264,32.630321],[120.45042400000001,32.630114],[120.45230300000001,32.631379],[120.45774700000001,32.630212],[120.45788899999998,32.632316],[120.46274699999998,32.632044],[120.464804,32.628272],[120.46769400000001,32.631597],[120.474946,32.627421],[120.475922,32.632],[120.477801,32.631226],[120.47819100000001,32.633047],[120.48007099999998,32.632044],[120.485124,32.631368],[120.485869,32.629078],[120.489096,32.628141],[120.488334,32.626265],[120.49227,32.625437],[120.49283700000001,32.623921],[120.49760700000002,32.623147],[120.49649,32.637713000000005],[120.49592299999999,32.640395],[120.506331,32.642139],[120.50725300000002,32.639828],[120.51046300000002,32.639185],[120.51037400000001,32.636437],[120.51393800000001,32.636394],[120.52509100000002,32.633712],[120.52507300000002,32.635347],[120.527928,32.634976],[120.530552,32.63587],[120.533833,32.63345],[120.537095,32.635413],[120.541493,32.631521],[120.55011,32.636067000000004],[120.55170600000001,32.634791],[120.55902900000001,32.637451],[120.559703,32.635609],[120.566707,32.637582],[120.56754,32.636623],[120.570998,32.637931],[120.572824,32.63562],[120.58048400000001,32.635729],[120.58041299999998,32.637517],[120.58504100000002,32.637495],[120.58823300000002,32.639283],[120.588197,32.640678],[120.59121100000002,32.642302],[120.592329,32.645431],[120.600325,32.649976],[120.597311,32.65172],[120.60195700000001,32.652309],[120.60186799999998,32.649497],[120.60380099999999,32.646673],[120.609759,32.640275],[120.61334000000001,32.640514],[120.615184,32.63695],[120.61245400000001,32.636884],[120.60968800000002,32.63514],[120.613518,32.63115],[120.61885500000001,32.62908900000001],[120.62057500000002,32.627432],[120.619316,32.622558],[120.620007,32.619832],[120.61832300000002,32.61835],[120.61656700000002,32.61341],[120.613323,32.606638],[120.613713,32.60389],[120.616035,32.604926],[120.615965,32.608383],[120.61940400000002,32.609092],[120.620433,32.607107],[120.617755,32.607009],[120.617791,32.602374],[120.620787,32.603683],[120.620965,32.607848],[120.62289700000001,32.608786],[120.622773,32.610804],[120.62444,32.610924],[120.624369,32.614664000000005],[120.628749,32.615504],[120.62890799999998,32.617575],[120.63124900000001,32.618044000000005],[120.63124900000001,32.611578],[120.63287999999999,32.613181],[120.638324,32.612799],[120.64007900000001,32.611469],[120.641711,32.614958],[120.64397999999998,32.615798],[120.64644499999999,32.611851],[120.65000900000001,32.608808],[120.65280999999999,32.608895],[120.653325,32.606005],[120.65508000000001,32.604577],[120.655435,32.602243],[120.65392700000001,32.601316],[120.65449499999998,32.597477],[120.65646300000002,32.59703],[120.65742100000001,32.593998000000006],[120.65280999999999,32.592449],[120.65008000000002,32.5939],[120.648661,32.590093],[120.647349,32.590529],[120.64667500000002,32.587715],[120.64850200000001,32.588119],[120.64930000000001,32.585086],[120.65261500000001,32.584421],[120.65169300000001,32.581956],[120.652013,32.574221],[120.66281099999999,32.573479],[120.66270500000002,32.575301],[120.665347,32.577919],[120.67024,32.58609],[120.670294,32.590235],[120.672741,32.589897],[120.67676600000001,32.591914],[120.676925,32.593114],[120.68009900000001,32.594478],[120.68346799999999,32.597477],[120.693912,32.60076],[120.69719200000002,32.601458],[120.699214,32.603486],[120.710047,32.603726],[120.70979900000002,32.601163],[120.71355800000002,32.601327],[120.71338100000001,32.600433],[120.720385,32.600934],[120.72088100000002,32.598153],[120.720385,32.593965],[120.719268,32.591249],[120.7298,32.592122],[120.730173,32.585195],[120.73350600000002,32.586897],[120.73535000000001,32.586581],[120.74026200000002,32.587944],[120.73969400000001,32.598426],[120.742638,32.598786],[120.743578,32.601752],[120.75469500000001,32.602287],[120.75969499999998,32.60149],[120.76453600000002,32.602701],[120.762781,32.603846],[120.768012,32.605755],[120.772338,32.604435],[120.775459,32.604708],[120.778172,32.60162100000001],[120.783792,32.601687],[120.78402299999999,32.600018],[120.78631000000001,32.599767],[120.78744500000002,32.60185],[120.793137,32.602036],[120.79347400000002,32.597433],[120.79210899999998,32.581258],[120.79134599999999,32.57865],[120.794821,32.579163],[120.79723300000002,32.581694000000006],[120.79969800000002,32.580767],[120.80748199999998,32.583854],[120.811223,32.58789],[120.817163,32.592209],[120.830763,32.597095],[120.839115,32.599047],[120.84003700000001,32.600934],[120.836224,32.602068],[120.83783800000002,32.606485],[120.84392,32.606125],[120.846757,32.604664],[120.851243,32.603922],[120.85539199999998,32.604391],[120.86560500000002,32.607379],[120.870499,32.609473],[120.868407,32.61112],[120.86271499999998,32.610073],[120.857413,32.612134],[120.852378,32.606703],[120.85119000000002,32.606845],[120.85090600000001,32.618328],[120.86346,32.618622],[120.863105,32.630343],[120.88339,32.630757],[120.88339,32.631357],[120.895589,32.631651],[120.89963200000001,32.633189],[120.906813,32.634595],[120.91018200000002,32.636197],[120.91521800000001,32.637277],[120.940982,32.644472],[120.970575,32.652974],[120.976019,32.649366],[120.97965399999998,32.642989],[120.97965399999998,32.63635],[120.97784500000002,32.63381],[120.961745,32.612178],[120.988431,32.606736000000005],[121.020489,32.605526],[121.051679,32.587159],[121.076893,32.57637],[121.110122,32.555892],[121.15311999999999,32.529275],[121.197325,32.511951],[121.26949199999999,32.483454],[121.287631,32.480199],[121.317899,32.477229],[121.33149900000001,32.476246],[121.351943,32.474269],[121.365809,32.47001],[121.39050900000001,32.460726],[121.405102,32.452926],[121.417425,32.443116],[121.425475,32.431032],[121.44054700000001,32.366082],[121.447072,32.299258],[121.450211,32.282262],[121.45776399999998,32.273922],[121.45985599999999,32.263863],[121.461523,32.252346],[121.468829,32.239765],[121.471134,32.226362],[121.469254,32.20836700000001],[121.461523,32.193732],[121.46008700000002,32.1858],[121.45947686455875,32.18239767664515],[121.45871778535498,32.17741862934297],[121.46032160476499,32.1722474866833],[121.46815344262744,32.149484463030134],[121.468846,32.147883],[121.47312,32.137974],[121.485656,32.137184],[121.52400899999999,32.137612],[121.54099499999998,32.153232],[121.54229,32.152125],[121.525534,32.136527],[121.54434700000002,32.123053],[121.54840700000001,32.122198000000004],[121.59257600000001,32.112922],[121.631709,32.100388],[121.72962200000002,32.069194],[121.75907400000001,32.059397],[121.76184,32.056116],[121.76712400000001,32.040271],[121.772391,32.033226],[121.856012,31.955229],[121.865037,31.940366],[121.870304,31.928281000000002],[121.874825,31.902106],[121.88915200000001,31.866623],[121.89745000000002,31.853537999999997],[121.940999,31.776566],[121.960149,31.736851],[121.96694000000001,31.729881],[121.970291,31.718870000000003],[121.96770199999999,31.703914],[121.96995399999999,31.671098],[121.97518499999998,31.617039000000002],[121.89558900000002,31.634599],[121.817819,31.652024000000004],[121.75194599999999,31.666095],[121.71526,31.673841],[121.64265000000002,31.697459],[121.63327,31.69616],[121.62733,31.697767999999996],[121.61176200000001,31.704287999999995],[121.60275400000002,31.706943],[121.60091,31.706998],[121.599669,31.703121],[121.59325,31.705379000000004],[121.59225700000002,31.70648],[121.578533,31.710533],[121.565022,31.716711000000004],[121.55138600000001,31.727381999999995],[121.549507,31.726963],[121.54012699999998,31.733316],[121.539417,31.735496],[121.528353,31.738348],[121.526686,31.74022],[121.514983,31.742873000000003],[121.513051,31.743699],[121.498564,31.753265],[121.487748,31.753418999999997],[121.476808,31.756148999999997],[121.46414699999998,31.75714],[121.45556499999999,31.759341],[121.44975000000001,31.761664],[121.44538799999998,31.764305000000004],[121.433277,31.768609000000005],[121.431486,31.769258],[121.425777,31.774266],[121.420918,31.779604],[121.4109,31.795581000000002],[121.41630800000001,31.797639000000004],[121.411503,31.806342],[121.405456,31.809840000000005],[121.399144,31.817475],[121.395385,31.821292],[121.385048,31.833534000000004],[121.376377,31.838571],[121.36928400000001,31.843278],[121.32305800000002,31.868536000000002],[121.315859,31.871482000000004],[121.310363,31.872504],[121.30190500000002,31.872713000000005],[121.29116000000002,31.870987],[121.28133600000001,31.869041000000003],[121.26557300000002,31.864127],[121.252115,31.857727000000004],[121.24206099999999,31.853406],[121.225305,31.847039],[121.200322,31.83514],[121.18150800000001,31.820412],[121.14921999999999,31.787285000000004],[121.118491,31.759077000000005],[121.106877,31.761410999999995],[121.09168100000001,31.772318000000002],[121.082744,31.778041],[121.072194,31.782662999999996],[121.06838199999999,31.783554000000002],[121.05953399999999,31.78449],[121.03398446678753,31.783988059763946],[121.03397369384766,31.78392504670159],[121.00788116455078,31.783633207994736],[120.9320068359375,31.801725465871957],[120.91724395751952,31.808727969741742],[120.90488433837889,31.816021680197924],[120.92033562628586,31.850723755926413],[120.90488433837889,31.816313416635875],[120.89286804199217,31.827398718328755],[120.89355468749999,31.834399275715842],[120.88600158691406,31.83614933209499],[120.88119506835936,31.84256592152673],[120.87913513183592,31.85218996892533],[120.87226867675781,31.860063442571104],[120.84150351088971,31.914049718805142],[120.84136962890625,31.913993226490213],[120.82695007324219,31.96905643253628],[120.81768035888672,31.984491512972703],[120.80806732177733,31.990897765011393],[120.80813648028523,31.991496003311646]]
    function createNtMask(egismap) {
        return createMask(egismap, ntGeo, 'rgba(10,10,10,0.825)');
    }
    extendEgis('createMask', createMask);
    extendEgis('createNtMask', createNtMask);
})();
